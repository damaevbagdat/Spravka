# Журнал изменений

## 24.12.2024 - Упрощение текста справки (обновление 2)

### Исправлено

#### Формулировка текста
- ✅ Изменена формулировка основного текста справки для избежания склонения ФИО
- **Было:** "По договору займа №... от ..., заключенному с {ФИО}, по состоянию на ..."
- **Стало:** "По договору займа №... от ..., Заемщик: {ФИО}, по состоянию на ..."
- ✅ Обновлено во всех местах:
  - `webapp/app.py` - функция create_excel_certificate (строка 357)
  - `webapp/app.py` - функция create_pdf_certificate (строка 479)
  - `scripts/generate_certificates.py` (строка 280)

### Причина изменения
Склонение русских имен - сложная задача с множеством исключений. Новая формулировка проще и понятнее, избегает грамматических ошибок.

---

## 24.12.2024 - Обновление маппинга и логотипа

### Исправлено

#### 1. Логотип
- ✅ Обновлен логотип компании SwissCapital (из JPG в PNG формат)
- ✅ Путь к логотипу: `assetslogo.png`
- ✅ Размеры при вставке в справку: 400x60 пикселей
- ✅ Добавлена библиотека Pillow в зависимости для работы с изображениями

#### 2. Маппинг столбцов Excel
Обновлен маппинг для поддержки новых названий столбцов:

**Номер договора:**
- `№ Номера договора` ✅
- `Номер договора`
- `№ договора`
- `Договор №`

**Дата договора:**
- `Даты договора` ✅
- `Дата договора`

**ФИО:**
- `ФИО`
- `ФИО клиента`
- `Клиент`

**Основной долг:**
- `Сумма ОД` ✅
- `Основной долг`
- `ОД`

**Вознаграждение (Проценты):**
- `Сумма процентов` ✅ (НОВОЕ)
- `Вознаграждение`
- `Проценты`

**Отсроченные проценты:**
- `Сумма отсроченных процентов` ✅

**Пеня за ОД:**
- `Сумма пеня за ОД` ✅
- `Сумма пени за ОД` ✅ (НОВОЕ)
- `Неустойка`

**Пеня за вознаграждение:**
- `Сумма пеня за вознаграждение` ✅
- `Сумма пени за вознаграждение` ✅ (НОВОЕ)

**Гос.пошлина:**
- `Сумма госпошлины` ✅ (НОВОЕ)
- `Гос.пошлина`
- `Госпошлина`

**Административные сборы:**
- `Административные сборы`
- `Адм. сборы`

**Общая сумма:**
- `Сумма займа` ✅ (НОВОЕ)
- `Общая сумма`
- `Итого`

#### 3. Обработка данных
- ✅ Исправлено отображение № договора и даты договора в справке
- ✅ Добавлена обработка пустых значений (trim для строк)
- ✅ Исправлен расчет общей суммы:
  - Если в Excel есть столбец "Сумма займа", используется это значение
  - Если нет - сумма рассчитывается автоматически из компонентов

#### 4. Обновлены файлы
- `webapp/app.py` - маппинг и обработка данных
- `webapp/requirements.txt` - добавлена Pillow==10.2.0
- `scripts/generate_certificates.py` - маппинг и путь к логотипу
- `data/clients_data_new.xlsx` - новый шаблон с актуальными столбцами

### Тестирование
Создан тестовый скрипт `test_fixes.py` для проверки:
- Загрузки логотипа
- Маппинга столбцов
- Создания справки с логотипом

### Примечания

**Почему логотип может выглядеть серым:**
1. Проверьте, что файл `assetslogo.png` имеет размер ~29 KB
2. Убедитесь, что в Excel включено отображение изображений
3. Логотип SwissCapital имеет красный текст "swiss" и черный "capital"

**Как использовать новый шаблон:**
1. Используйте файл `data/clients_data_new.xlsx` как шаблон
2. Заполните данные согласно заголовкам
3. Столбец "Сумма займа" можно заполнить вручную или оставить пустым для автоматического расчета

**Запуск тестов:**
```bash
python test_fixes.py
```

**Создание нового шаблона:**
```bash
python create_template.py
```
